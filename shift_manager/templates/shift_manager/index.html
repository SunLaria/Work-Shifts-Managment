{% extends "shift_manager/base.html" %}
{% block content %}
<table>
    <tr>
        <th></th>
        {% load filters %}

        {% for week_day in "0 1 2 3 4 5 6"|list_split %}
        <th>{{ 'Sunday Monday Tuesday Wednesday Thursday Friday Saturday'|list_split|list_index:week_day }}
            <br>
            {{ week_dates|list_index:week_day }}
        </th>
    
        {% endfor %}
    </tr>
    <tr>
        <th>Morning<br>06:00-15:00</th>
        <form action="{% url 'save' %}" method="post" id="form1">
            {% csrf_token %}
            {% for week_day in "0 1 2 3 4 5 6"|list_split %}
            <td>
                {% with cell_date=week_dates|list_index_date:week_day %}
                <select id="Worker_row1" name="Worker">
                    {% filter_worker_name cell_date "mo" %}
                    <option value="empty">------</option>
                    {% for worker in available_workers_list %}
                    <option value="{{ worker.Worker_ID }}"> {{ worker.Full_Name }} </option>
                    {% endfor %}
                    <input type="text" name="Shift" id="" value="mo" hidden>
                    <input type="date" name="Date" id="" value="{{ cell_date }}" hidden>
                </select>
                {% endwith %}
            </td>
            {% endfor %}
            <td><input type="submit" value="&#x2713">
                <input type="submit" value="&#x1f5d1" formaction="{% url 'delete' %}" id="clear-row"></td>
        </form>
    </tr>
    <tr>
        <th>Afternoon<br>15:00-20:00</th>
        <form action="{% url 'save' %}" method="post" id="form2">
            {% csrf_token %}
            {% for week_day in "0 1 2 3 4 5 6"|list_split %}
            <td>
                {% with cell_date=week_dates|list_index_date:week_day %}
                <select id="Worker_row2" name="Worker">
                    {% filter_worker_name cell_date "af" %}
                    <option value="empty">------</option>
                    {% for worker in available_workers_list %}
                    <option value="{{ worker.Worker_ID }}"> {{ worker.Full_Name }} </option>
                    {% endfor %}
                    <input type="text" name="Shift" id="" value="af" hidden>
                    <input type="date" name="Date" id="" value="{{ cell_date }}" hidden>
                </select>
                {% endwith %}
            </td>
            {% endfor %}
            <td><input type="submit" value="&#x2713">
                <input type="submit" value="&#x1f5d1" formaction="{% url 'delete' %}" id="clear-row"></td>
        </form>
    </tr>
    <tr>
        <th>Night<br>20:00-06:00</th>
        <form action="{% url 'save' %}" method="post" id="form3">
            {% csrf_token %}
            {% for week_day in "0 1 2 3 4 5 6"|list_split %}
            <td>
                {% with cell_date=week_dates|list_index_date:week_day %}
                <select id="Worker_row3" name="Worker">
                    {% filter_worker_name cell_date "ni"|safe%}
                    <option value="empty">------</option>
                    {% for worker in available_workers_list %}
                    <option value="{{ worker.Worker_ID }}"> {{ worker.Full_Name }} </option>
                    {% endfor %}
                    <input type="text" name="Shift" id="" value="ni" hidden>
                    <input type="date" name="Date" id="" value="{{ cell_date }}" hidden>
                </select>
                {% endwith %}
            </td>
            {% endfor %}
            <td><input type="submit"  value="&#x2713">
                <input type="submit" value="&#x1f5d1" formaction="{% url 'delete' %}" id="clear-row"></td>
        </form>
    </tr>
</table>
<input type="text" hidden id="week_num" value="{{ week_num }}">
<div id="calender_buttons">
    <button id="back_button" onclick=button_control(week_num-1)><</button>
    <button id="front_button" onclick=button_control(week_num+1)>></button>
</div>
<div id="action-buttons-div">
<button style="cursor: pointer; font-size: medium;"  id="clear_all">Clear All!</button>
<button style="cursor: pointer; font-size: medium;" id="save_all">Save All!</button>
{{ message }}
</div>
<div id="worker_list">
    <table style="font-size:small;">
        <tr>
            <th style="font-size: small;">Worker ID:</th>
            <th style="font-size: small;">Full Name:</th>
            <th style="font-size: small;">Available Work Days:</th>
        </tr>
        {% for worker in workers_list %}
        <tr>
            <td>{{ worker.Worker_ID }}</td>
            <td>{{ worker.Full_Name }}</td>
            <td>{{ worker.Work_Days_Left }}</td>
        </tr>
        {% endfor %}
    </table>
</div>
<script>
    
    let week_num = parseInt(document.getElementById("week_num").value)
    function button_control(value){
        return window.location.replace("/"+String(value));
    }

    
    
    $("#save_all").click(function(){
            $.post("{% url 'save' %}",$('form').serialize());
            setTimeout(function(){window.location.reload();},1000)
    });


    $("#clear_all").click(function(){
            if (confirm("Are you sure?") == true){
                $.post("{% url 'delete' %}",$('form').serialize());
                setTimeout(function(){window.location.reload();},1000)
            };
            
    });


</script>
{% endblock %}
